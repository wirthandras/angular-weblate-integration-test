name: Weblate export
run-name: ${{ github.actor }} is run export to Weblate

on: 
  workflow_dispatch:
jobs:
 
  weblate-export:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Get current date
      id: date
      run: echo "::set-output name=date::$(date +'%Y-%m-%d-%H-%M-%S')"   
    - uses: peterjgrainger/action-create-branch@v2.2.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        branch: 'weblate-export-${{ steps.date.outputs.date }}'
        sha: '${{ github.event.pull_request.head.sha }}'        
    - uses: actions/checkout@v3
      with:
        ref: 'weblate-export-${{ steps.date.outputs.date }}-input'
    - uses: actions/setup-node@v3
      with:
        node-version: 12
    - run: npm ci
    - run: npm run extract-i18n
    - uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: Automated Change
        
  create-output-branch:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@weblate-export-${{ steps.date.outputs.date }}-input
    - uses: peterjgrainger/action-create-branch@v2.2.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        branch: 'weblate-export-${{ steps.date.outputs.date }}-output'  
